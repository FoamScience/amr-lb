<!doctype html><html lang=en>
<head>
<meta name=generator content="Hugo 0.89.4">
<meta charset=utf-8>
<title>AMR-LB</title>
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="black-translucent">
<link rel=preconnect href=https://fonts.googleapis.com>
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400&family=Fira+Sans&display=swap" rel=stylesheet>
<link href=/amr-lb/css/interactive-image.min.css rel=stylesheet>
<script type=text/javascript src=js/jquery.min.js></script>
<script type=text/javascript src=js/interactive-image.min.js></script>
<link rel=stylesheet type=text/css href=js/tikzjax/fonts.css>
<script src=js/tikzjax/tikzjax.js></script>
<link rel=stylesheet href=/amr-lb/reveal-js/reset.css>
<link rel=stylesheet href=/amr-lb/reveal-js/reveal.css><link rel=stylesheet href=/amr-lb/reveal-js/theme/black.css id=theme>
<link rel=stylesheet href=/amr-lb/highlight-js/a11y-light.min.css><link rel=stylesheet href=/amr-lb/css/customized.css id=custom_css>
</head>
<body>
<div class=reveal>
<div class=slides>
<section><h2 id=towards--dynamically--load-balanced-reactive-cfd-using-openfoam>Towards dynamically load-balanced reactive CFD using OpenFOAM</h2>
<div style=height:10%></div>
<p>Mohammed Elwardi Fadeli,<br>
Holger Marschall</p>
<p>12/2021</p>
</section>
<section><div style=height:10%></div>
<div class=columns-container>
<div class=col style=width:30%;float:left;padding:60px>
<img data-src=images/profile.png>
</div>
<div style=flex:2>
<div style=height:40px></div>
<section data-markdown>
<script type=text/template>
<ul>
<li>Msc. in Petroleum Engineering <!-- .element: style="font-size: 0.8em;" --></li>
<li>Maintainer of an OpenFOAM-based Reservoir Engineering Toolkit (OpenRSR, <!-- .element: class="fragment" data-fragment-index="2"  style="font-size: 0.8em;"-->
providing coupled solvers for Black-Oil Equations) <!-- .element: class="fragment" data-fragment-index="2"  style="font-size: 0.7em;"--></li>
<li>LFCE-certified (Linux Engineer) who likes frictions with Math problems <!-- .element: class="fragment" data-fragment-index="3"  style="font-size: 0.8em;"-->
</script></li>
</ul>
</section>
</div>
</div>
</section><section>
<h3 id=outline>Outline</h3>
<h4 id=unified-dynamic-load-balancing-dlb-framework-for-rcfd>Unified Dynamic Load-Balancing (DLB) Framework for rCFD</h4>
<ol>
<li>Current Status:</li>
</ol>
<ul>
<li>Transport equations: DLB and adaptive polyhedral mesh refinement</li>
<li>Chemistry: DLB applied to chemical source terms (DLBFoam)</li>
</ul>
<ol start=2>
<li>Future Steps</li>
</ol>
</section>
<section data-noprocess data-shortcode-slide data-background-image=images/bg-amr.png>
<h1 id=adaptive-mesh-refinement>Adaptive Mesh Refinement</h1>
</section><section>
<h2 id=why-would-we-opt-for-amr>Why would we opt for AMR?</h2>
<section data-markdown>
<script type=text/template>
<ul>
<li><strong>Dynamically</strong> increase mesh resolution where needed, i.e. in moving regions of interest (locally maintain accuracy)</li>
<li>Coarsen the mesh in smooth flow regions to save computation time but preserving local accuracy<!-- .element: class="fragment" data-fragment-index="3" -->
<ul>
<li>Uniformly fine meshes are usually too expensive <!-- .element: class="fragment" data-fragment-index="3"  style="font-size: 0.8em;"--></li>
<li>Regions where no critical/fine flow features are developing <!-- .element: class="fragment" data-fragment-index="3"  style="font-size: 0.8em;"-->
</script></li>
</ul>
</li>
</ul>
</section>
</section><section>
<ul>
<li>AMR Has potential for local (computationally cheap) accuracy increase:
<ol>
<li>Start solving on coarse meshes</li>
<li>Compute discretization or residual errors</li>
<li>Refine where errors are high</li>
<li>Repeat steps 1-3 until errors fall under a certain tolerance</li>
<li>Pass to the next time step</li>
</ol>
</li>
</ul>
</section><section>
<section data-noproecess>
<h3> GMG methods vs. AMR</h3>
<div class=tikz>
<script type=text/tikz>
\begin{tikzpicture}[every node/.style={scale=2.5}]
    \usetikzlibrary{positioning}
    \begin{scope}[
            yshift=-83,every node/.append style={
            yslant=0.5,xslant=-1},yslant=0.5,xslant=-1
            ]
        \fill[white,fill opacity=0.9] (0,0) rectangle (5,5);
        \draw[step=4mm, black] (0,0) grid (5,5); %defining grids
        %\draw[step=1mm, red!50,thin] (3,1) grid (4,2);  %Nested Grid
        \draw[black,very thick] (0,0) rectangle (5,5);%marking borders
        %\fill[red] (0.05,0.05) rectangle (0.35,0.35);
    \end{scope}
<pre><code>\begin{scope}[
        yshift=0,every node/.append style={
        yslant=0.5,xslant=-1},yslant=0.5,xslant=-1
        ]
    \fill[white,fill opacity=0.9] (0,0) rectangle (5,5);
    \draw[step=6mm, black] (0,0) grid (5,5); %defining grids
    %\draw[step=1mm, red!50,thin] (3,1) grid (4,2);  %Nested Grid
    \draw[black,very thick] (0,0) rectangle (5,5);%marking borders
    %\fill[red] (0.05,0.05) rectangle (0.35,0.35);
\end{scope}

\begin{scope}[
	yshift=90,every node/.append style={
	yslant=0.5,xslant=-1},yslant=0.5,xslant=-1
	             ]
    \fill[white,fill opacity=0.9] (0,0) rectangle (5,5);
    \draw[step=10mm, black] (0,0) grid (5,5); %defining grids
    %\draw[step=1mm, red!50,thin] (3,1) grid (4,2);  %Nested Grid
    \draw[black,very thick] (0,0) rectangle (5,5);%marking borders
    %\fill[red] (0.05,0.05) rectangle (0.35,0.35);
\end{scope}
	
\begin{scope}[
        yshift=-83, xshift=500,every node/.append style={
        yslant=0.5,xslant=-1},yslant=0.5,xslant=-1
        ]
    \fill[white,fill opacity=0.9] (0,0) rectangle (5,5);
    \draw[step=10mm, black] (0,0) grid (5,5); %defining grids
    \draw[step=5mm, green!50!black] (1,1) grid (4,3);  %Nested Grid
    \draw[step=2.5mm, red] (3,1) grid (4,2);  %Nested Grid
    \draw[black,very thick] (0,0) rectangle (5,5);%marking borders
    %\fill[red] (0.05,0.05) rectangle (0.35,0.35);
\end{scope}

\begin{scope}[
	yshift=90, xshift=500, every node/.append style={
	yslant=0.5,xslant=-1},yslant=0.5,xslant=-1
	             ]
    \fill[white,fill opacity=0.9] (0,0) rectangle (5,5);
    \draw[step=10mm, black] (0,0) grid (5,5); %defining grids
    %\draw[step=1mm, red!50,thin] (3,1) grid (4,2);  %Nested Grid
    \draw[black,very thick] (0,0) rectangle (5,5);%marking borders
    %\fill[red] (0.05,0.05) rectangle (0.35,0.35);
\end{scope}
	

\draw[-latex,thick,draw=green!50!black](5.8,-.3) node[right,color=white]{Fine mesh}
    to[out=180,in=90] (3.9,-1);
\draw[-latex,thick,draw=green!50!black] (6.2,2) node[right,color=white]{Finer mesh}
     to[out=180,in=90] (4,2);
\draw[-latex,thick,draw=green!50!black](5.9,5) node[right,color=white] (coarse) {Coarse mesh}
    to[out=180,in=90] (3.6,5);
\draw[-latex,thick,draw=green!50!black](11.2,5) to[out=0,in=90] (14,5);
\draw[-latex,thick,draw=green!50!black](10.2,-.3) to[out=0,in=90] (14,-1);
</code></pre>
<p>\end{tikzpicture}
</script></p>
</div>
</section>
</section><section>
<h3 id=success-stories-when-it-works>Success stories, when it works</h3>
<ul>
<li>10x Speedup for Adaptive Mesh Fluid Simulations on GPU, <a href=https://arxiv.org/pdf/0910.5547.pdf>P. Weng et al. (2009)</a></li>
<li>8x Speedup for Shock Hydrodynamics, <a href=https://crd.lbl.gov/assets/pubs_presos/AMCS/ANAG/A113.pdf>Berger and Colella (1988)</a></li>
</ul>
</section><section>
<h2 id=whats-already-available>What&rsquo;s already available?</h2>
<ul>
<li>OpenFOAM has a mature <a href=https://github.com/OpenFOAM/OpenFOAM-dev/tree/master/src/dynamicMesh/polyTopoChange/polyTopoChange/hexRef8>hex-based adaptive mesh refinement engine</a>, which has been enhanced by load-balancing in Darmstadt (<a href=https://doi.org/10.1016/j.softx.2019.100317>DOI: 10.1016/j.softx.2019.100317</a>)</li>
<li>Foundation of polyhedral adaptive refinement
in Foam-Extend 4, <a href=https://github.com/Unofficial-Extend-Project-Mirror/foam-extend-foam-extend-4.0/tree/nextRelease/src/dynamicMesh/topoChangerFvMesh/dynamicPolyRefinementFvMesh>nextRelease branch</a> (<a href=https://doi.org/10.4271/2019-24-0128>DOI: 10.4271/2019-24-0128</a>)</li>
</ul>
</section><section>
<h2 id=what-were-bringing-to-the-table>What weâ€™re bringing to the table?</h2>
<ul>
<li>Native multi-criteria refinement & unrefinement for polyhedral meshes
<ul>
<li>Built on top of Foam-Extend&rsquo;s engine</li>
<li>With support for cell-count based Load Balancing</li>
<li>Multiple interface refinement selection criteria, e.g. interface/front criterion</li>
</ul>
</li>
</ul>
</section>
<section data-noprocess data-shortcode-slide data-background-color=white>
<h3 id=interface-capturing-refinement>Interface-Capturing refinement</h3>
<p><video style="display:block;margin:0 auto;padding:0" data-autoplay src=videos/interface.webm></video></p>
</section>
<section data-noprocess data-shortcode-slide data-background-color=white>
<h3 id=interface-capturing-refinement-bruniformly-fine-mesh-51k>Interface-Capturing refinement <br>(Uniformly fine mesh: +51k)</h3>
<img style=width:85%;margin:0;padding:0;position-top:0 data-src=images/cell_count.png>
</section><section>
<p style=text-align:center>Interface-Capturing refinement</p>
<section data-auto-animate data-auto-animate-unmatched=false>
<pre class=code-wapper data-id=code-animation><code class="language-cpp hljs" data-trim data-noescape data-auto-animate data-line-numbers=1-3,5,7>

<span class=hljs-title>dynamicFvMesh</span> dynamicPolyRefinementFvMesh<span class=hljs-punctuation>;</span>
<span class=hljs-type>dynamicRefineFvMeshCoeffs</span> <span class=hljs-punctuation>{</span>
    <span class=hljs-comment>// 1. Global refinement settings</span>
    ...
    <span class=hljs-comment>// 2. Refinements description</span>
    ...
<span class=hljs-punctuation>}</span>

</code></pre>
</section>
<section data-auto-animate data-auto-animate-unmatched=false>
<pre class=code-wapper data-id=code-animation><code class="language-cpp hljs" data-trim data-noescape data-auto-animate data-line-numbers=3-10>

<span class=hljs-title>dynamicFvMesh</span> dynamicPolyRefinementFvMesh<span class=hljs-punctuation>;</span>
<span class=hljs-type>dynamicRefineFvMeshCoeffs</span> <span class=hljs-punctuation>{</span>
    <span class=hljs-comment>// 1. Global refinement settings</span>
    <span class=hljs-comment>// When to refine and unrefine</span>
    <span class=hljs-title>refineInterval</span> <span class=hljs-number>1</span><span class=hljs-punctuation>;</span>
    <span class=hljs-title>unrefineInterval</span> <span class=hljs-number>1</span><span class=hljs-punctuation>;</span>
    <span class=hljs-comment>// Stop refinining after reaching a certain level</span>
    <span class=hljs-title>maxRefinementLevel</span> <span class=hljs-number>3</span><span class=hljs-punctuation>;</span>
    <span class=hljs-comment>// Do refinement and refinement separately?</span>
    <span class=hljs-title>separateUpdates</span> <span class=hljs-keyword>false</span><span class=hljs-punctuation>;</span>
    <span class=hljs-comment>// 2. Refinements description</span>
    ...
<span class=hljs-punctuation>}</span>

</code></pre>
</section>
<section data-auto-animate data-auto-animate-unmatched=false>
<pre class=code-wapper data-id=code-animation><code class="language-cpp hljs" data-trim data-noescape data-auto-animate data-line-numbers=5-11>

<span class=hljs-title>dynamicFvMesh</span> dynamicPolyRefinementFvMesh<span class=hljs-punctuation>;</span>
<span class=hljs-type>dynamicRefineFvMeshCoeffs</span> <span class=hljs-punctuation>{</span>
    <span class=hljs-comment>// 1. Global refinement settings</span>
    ...
    <span class=hljs-comment>// 2. Refinements description</span>
    <span class=hljs-title>refinements</span> <span class=hljs-punctuation>(</span>
        basedOnAlpha1 <span class=hljs-punctuation>{</span>
            ...
        <span class=hljs-punctuation>}</span>
        <span class=hljs-comment>// More refinement/unrefinement operations</span>
    <span class=hljs-punctuation>)</span><span class=hljs-punctuation>;</span>
<span class=hljs-punctuation>}</span>

</code></pre>
</section>
<section data-auto-animate data-auto-animate-unmatched=false>
<pre class=code-wapper data-id=code-animation><code class="language-cpp hljs" data-trim data-noescape data-auto-animate data-line-numbers=7-12,14>

<span class=hljs-title>dynamicFvMesh</span> dynamicPolyRefinementFvMesh<span class=hljs-punctuation>;</span>
<span class=hljs-type>dynamicRefineFvMeshCoeffs</span> <span class=hljs-punctuation>{</span>
    <span class=hljs-comment>// 1. Global refinement settings</span>
    ...
    <span class=hljs-comment>// 2. Refinements description</span>
    <span class=hljs-title>refinements</span> <span class=hljs-punctuation>(</span>
        basedOnAlpha1 <span class=hljs-punctuation>{</span>
            <span class=hljs-comment>// Individual settings</span>
            <span class=hljs-title>refineInterval</span> <span class=hljs-number>1</span><span class=hljs-punctuation>;</span>
            <span class=hljs-title>unrefineInterval</span> <span class=hljs-number>1</span><span class=hljs-punctuation>;</span>
            <span class=hljs-title>maxRefinementLevel</span> <span class=hljs-number>3</span><span class=hljs-punctuation>;</span>
            <span class=hljs-title>separateUpdates</span> <span class=hljs-keyword>false</span><span class=hljs-punctuation>;</span>
            ...
        <span class=hljs-punctuation>}</span>
        <span class=hljs-comment>// More refinement/unrefinement operations</span>
    <span class=hljs-punctuation>)</span><span class=hljs-punctuation>;</span>
<span class=hljs-punctuation>}</span>

</code></pre>
</section>
<section data-auto-animate data-auto-animate-unmatched=false>
<pre class=code-wapper data-id=code-animation><code class="language-cpp hljs" data-trim data-noescape data-auto-animate data-line-numbers=7,10-18>

<span class=hljs-title>dynamicFvMesh</span> dynamicPolyRefinementFvMesh<span class=hljs-punctuation>;</span>
<span class=hljs-type>dynamicRefineFvMeshCoeffs</span> <span class=hljs-punctuation>{</span>
    <span class=hljs-comment>// 1. Global refinement settings</span>
    ...
    <span class=hljs-comment>// 2. Refinements description</span>
    <span class=hljs-title>refinements</span> <span class=hljs-punctuation>(</span>
        basedOnAlpha1 <span class=hljs-punctuation>{</span>
            <span class=hljs-comment>// Individual settings</span>
            ...
            <span class=hljs-comment>// Cell selection</span>
            <span class=hljs-type>refinementSelection</span> <span class=hljs-punctuation>{</span>
                <span class=hljs-title>type</span>           interfaceRefinement<span class=hljs-punctuation>;</span>
                <span class=hljs-title>fieldNames</span>     <span class=hljs-punctuation>(</span> alpha1 <span class=hljs-punctuation>)</span><span class=hljs-punctuation>;</span> 
                <span class=hljs-title>innerRefLayers</span> <span class=hljs-number>1</span><span class=hljs-punctuation>;</span>
                <span class=hljs-title>outerRefLayers</span> <span class=hljs-number>1</span><span class=hljs-punctuation>;</span>
                <span class=hljs-title>cellPointCellSmoothing</span> <span class=hljs-keyword>on</span><span class=hljs-punctuation>;</span>
            <span class=hljs-punctuation>}</span>
        <span class=hljs-punctuation>}</span>
        <span class=hljs-comment>// More refinement/unrefinement operations</span>
    <span class=hljs-punctuation>)</span><span class=hljs-punctuation>;</span>
<span class=hljs-punctuation>}</span>

</code></pre>
</section>
</section><section>
<h3 id=more-refinementunrefinement-criteria>More refinement/unrefinement criteria</h3>
<div style="height=1em">
<section data-markdown>
<script type=text/template>
In addition to the interface refinement criterion, we have developed:
- Error-driven refinement selection criteria <!-- .element: style="font-size: 0.9em;"-->
    - local residual error estimate<!-- .element: style="font-size: 0.8em;"-->
    - local discretisation error estimate<!-- .element: style="font-size: 0.8em;"-->
- further field-based refinement selection criteria: _values, gradient_ and/or _curl_<!-- .element: style="font-size: 0.9em;"-->
- User-supplied (dynamic) code for refinement selection<!-- .element: style="font-size: 0.9em;"-->
</script>
</section>
</section><section>
<h3 id=user-supplied-code-for-refinement-selection>User-supplied code for refinement selection</h3>
<pre class=code-wapper data-id=code-animation><code class="language-cpp hljs" data-trim data-noescape data-auto-animate data-line-numbers=1-6|9-15|17-29|31-43|45-51|54-56>

<span class=hljs-type>refineBasedOnResiduals</span>
<span class=hljs-punctuation>{</span>
    <span class=hljs-title>refineInterval</span>   <span class=hljs-number>1</span><span class=hljs-punctuation>;</span>
    <span class=hljs-title>unrefineInterval</span> <span class=hljs-number>10</span><span class=hljs-punctuation>;</span>
    <span class=hljs-title>maxRefinementLevel</span>   <span class=hljs-number>1</span><span class=hljs-punctuation>;</span>
    <span class=hljs-title>separateUpdates</span> <span class=hljs-keyword>false</span><span class=hljs-punctuation>;</span>

    <span class=hljs-comment>// Refinement selection criteria</span>
    <span class=hljs-type>refinementSelection</span>
    <span class=hljs-punctuation>{</span>
        <span class=hljs-title>type</span>        codedFieldBoundsRefinement<span class=hljs-punctuation>;</span>
        <span class=hljs-title>fieldName</span>   magResError<span class=hljs-punctuation>;</span>
        <span class=hljs-title>lowerBound</span>  <span class=hljs-number>0</span><span class=hljs-punctuation>;</span>
        <span class=hljs-title>upperBound</span>  <span class=hljs-number>1</span><span class=hljs-punctuation>;</span>
        <span class=hljs-title>cellPointCellSmoothing</span> <span class=hljs-keyword>on</span><span class=hljs-punctuation>;</span>

        <span class=hljs-title>codeInclude</span>
        <span class=hljs-punctuation>#{</span>
            #include "errorEstimate.H"
            #include "resError.H"
<span class=hljs-punctuation>        #}</span><span class=hljs-punctuation>;</span>
        <span class=hljs-title>codeLibs</span>
        <span class=hljs-punctuation>#{</span>
            -lerrorEstimation
<span class=hljs-punctuation>        #}</span><span class=hljs-punctuation>;</span>
        <span class=hljs-title>codeOptions</span>
        <span class=hljs-punctuation>#{</span>
            -I$(LIB_SRC)/errorEstimation/lnInclude
<span class=hljs-punctuation>        #}</span><span class=hljs-punctuation>;</span>

        <span class=hljs-title>code</span>
        <span class=hljs-punctuation>#{</span>
            // Return immediately if 1st timeStep
            if (mesh().time().timeIndex() <= 1)
            {
                return labelList().xfer();
            }
            // Get refs to involved fields
            const auto& phi = mesh().lookupObject<surfacescalarfield>("phi");
            const auto& U = mesh().lookupObject<volvectorfield>("U");
            const auto& nu = mesh().lookupObject<volscalarfield>("nu");
            const auto& p = mesh().lookupObject<volscalarfield>("p");
            const auto& rho = mesh().lookupObject<volscalarfield>("rho");

            // Estimate the error vector
            errorEstimate<vector> ee
            (
                resError::div(phi, U)
                - resError::laplacian(nu, U)
                + fvc::grad(p/rho)
            );
            volScalarField magResError = mag(ee.error());
            scalar maxResErr = gMax(magResError);
            field_.internalField() = magResError.internalField();   
            lowerBound_ = 3*magResError.weightedAverage(mesh().V()).value();
            upperBound_ = maxResErr;
<span class=hljs-punctuation>        #}</span><span class=hljs-punctuation>;</span>
    <span class=hljs-punctuation>}</span>
<span class=hljs-punctuation>}</span>

</code></pre>
</section>
<section data-noprocess data-shortcode-slide data-background-color=white>
<h3 id=residuals-driven-refinement>Residuals-driven refinement</h3>
<p><video style="display:block;margin:0 auto;padding:0" data-autoplay src=videos/residuals.webm></video></p>
</section>
<section data-noprocess data-shortcode-slide data-background-color=white>
<h3 id=multi-criteria-refinement-process-per-timestep>Multi-Criteria Refinement process (per timeStep)</h3>
<section data-transition=fade-out>
<img style=width:75% data-src=images/17.png>
</section>
<section data-transition="fade-in fade-out">
<img style=width:75% data-src=images/18.png>
</section>
<section data-transition="fade-in fade-out">
<img style=width:75% data-src=images/19.png>
</section>
</section><section>
<h3 id=multi-criteria-refinement-process-per-timestep-1>Multi-Criteria Refinement process (per timeStep)</h3>
<script type=text/javascript>var items=[{type:"text",title:"Cell Level 0",description:"Initial cell size",position:{left:170,top:90}},{type:"text",title:"Cell Level 1",description:"",position:{left:185,top:180}},{type:"text",title:"Cell Level 2",description:"",position:{left:250,top:155}},{type:"text",title:"Cell Level 3",description:"Max refinement level",position:{left:350,top:170}}],options={allowHtml:!0};$(document).ready(function(){$("#my-interactive-image").interactiveImage(items,options)})</script>
<div id=my-interactive-image style=margin:auto;width:800px;height:463px;border-radius:8px;background-size:cover;background-image:url(images/levels.png)></div>
</section>
<section data-noprocess data-shortcode-slide data-background-image=images/bg-lb.png>
<h1 id=load-balancing>Load Balancing</h1>
</section><section>
<h3 id=load-balance-the-mesh-after-topology-changes>Load-Balance the mesh after topology changes</h3>
<ul>
<li>
<p>Refinement methods generally cause imbalance for static domain decomposition cases.</p>
</li>
<li>
<p>The Load-Balancer engine in Foam-Extend can auto-sense processor
imbalance with respect to cell-count</p>
</li>
<li>
<p>It also tries to migrates adjacent cells between processors if possible</p>
</li>
</ul>
</section><section>
<pre class=code-wapper data-id=code-animation><code class="language-cpp hljs" data-trim data-noescape data-auto-animate data-line-numbers=1-3,13|4|5-12>

<span class=hljs-title>dynamicFvMesh</span> loadBalanceDynamicPolyRefinementFvMesh<span class=hljs-punctuation>;</span>
<span class=hljs-type>loadBalanceFvMeshCoeffs</span>
<span class=hljs-punctuation>{</span>
    <span class=hljs-title>imbalanceTrigger</span> <span class=hljs-number>0.2</span><span class=hljs-punctuation>;</span>
    <span class=hljs-title>numberOfSubdomains</span> <span class=hljs-number>4</span><span class=hljs-punctuation>;</span>
    <span class=hljs-title>method</span>          hierarchical<span class=hljs-punctuation>;</span>
    <span class=hljs-type>hierarchicalCoeffs</span>
    <span class=hljs-punctuation>{</span>
        <span class=hljs-title>n</span>       <span class=hljs-punctuation>(</span> <span class=hljs-number>1</span> <span class=hljs-number>2</span> <span class=hljs-number>2</span> <span class=hljs-punctuation>)</span><span class=hljs-punctuation>;</span>
        <span class=hljs-title>delta</span>   <span class=hljs-number>0.001</span><span class=hljs-punctuation>;</span>
        <span class=hljs-title>order</span>   xyz<span class=hljs-punctuation>;</span>
    <span class=hljs-punctuation>}</span>
<span class=hljs-punctuation>}</span>

</code></pre>
</section>
<section data-noprocess data-shortcode-slide data-background-color=white>
<h3 id=dynamically-load-balance-after-amr-operations>Dynamically load-balance after AMR operations</h3>
<p><video style="display:block;margin:0 auto;padding:0" data-autoplay src=videos/loadbalance.webm></video></p>
</section><section>
<h3 id=load-balanced-chemistry>Load-Balanced Chemistry</h3>
<p>What Bulut Tekgul et al. have achieved with <strong><a href=https://github.com/Aalto-CFD/DLBFoam>DLBFoam</a></strong>:</p>
<ul>
<li>Load balance the number of <strong>Chemistry ODE problems</strong> across processes (<a href=https://doi.org/10.1016/j.cpc.2021.108073>DOI: 10.1016/j.cpc.2021.108073</a>)
<ul>
<li>Solved independently during each CFD iteration</li>
<li>Employ reference solution mapping to (thermo-chemically) similar cells</li>
</ul>
</li>
</ul>
</section><section>
<p style=text-align:center>An example of DLBFoam run with the Hex-based adaptive refinement engine (courtesy of Bulut, Argonne National Labs)</p>
<video style="scale:.85;display:block;margin:0 auto;padding:0" data-autoplay src=videos/dlbfoam.webm></video>
</section><section>
<h3 id=load-balancing-for-particle-simulations>Load-Balancing for particle simulations</h3>
<p>A simplistic approach was adopted in <a href=https://www.sciencedirect.com/science/article/pii/S0010465517303363>mdFoam+</a>
by S.M. Longshaw et al. to balance particles count</p>
<pre><code class=language-cpp data-line-numbers=7-8|10,13,15|21-22>if ( Pstream::parRun() )
{
    const scalar&amp; allowableImbalance = maxImbalance_;
        
    //First determine current level of imbalance - do this for all
    // parallel runs, even if balancing is disabled
    scalar nGlobalParticles = cloud_.size();
    Foam::reduce(nGlobalParticles, sumOp&lt;scalar&gt;());
    
    scalar idealNParticles = scalar(nGlobalParticles)/scalar(Pstream::nProcs());
    
    scalar nParticles = cloud_.size();
    scalar localImbalance = mag(nParticles - idealNParticles);
    Foam::reduce(localImbalance, maxOp&lt;scalar&gt;());
    scalar maxImbalance = localImbalance/idealNParticles;
    
    Info &lt;&lt; &quot;    Maximum imbalance = &quot; &lt;&lt; 100*maxImbalance &lt;&lt; &quot;%&quot; &lt;&lt; endl;
    
    if( maxImbalance &gt; allowableImbalance &amp;&amp; enableBalancing_)
    {   
        // Call reconstructPar and decomposeDSMCLoadBalancePar 
        // on master
    }
}
</code></pre>
</section>
<section><h1 id=next-steps>Next steps</h1>
<ul>
<li>Dynamic Load-Balancing of particulate flows</li>
<li>Devise a unified framework</li>
</ul>
</section>
</div>
</div>
<script type=application/json id=reveal-hugo-site-params>{"custom_css":"css/customized.css","highlight_theme":"a11y-light","width":"1200"}</script>
<script type=application/json id=reveal-hugo-page-params>null</script>
<script src=/amr-lb/reveal-js/reveal.js></script>
<script type=text/javascript src=/amr-lb/reveal-js/plugin/markdown/markdown.js></script>
<script type=text/javascript src=/amr-lb/reveal-js/plugin/highlight/highlight.js></script>
<script type=text/javascript src=/amr-lb/reveal-js/plugin/zoom/zoom.js></script>
<script type=text/javascript src=/amr-lb/reveal-js/plugin/notes/notes.js></script>
<script type=text/javascript>var revealHugoDefaults,revealHugoSiteParams,revealHugoPageParams,options;function camelize(a){return a&&Object.keys(a).forEach(function(b){newK=b.replace(/(\_\w)/g,function(a){return a[1].toUpperCase()}),newK!=b&&(a[newK]=a[b],delete a[b])}),a}revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById('reveal-hugo-site-params').innerHTML),revealHugoPageParams=JSON.parse(document.getElementById('reveal-hugo-page-params').innerHTML),options=Object.assign({plugins:[RevealZoom,RevealNotes,RevealMarkdown,RevealHighlight]},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams)),Reveal.initialize(options)</script>
</body>
</html>